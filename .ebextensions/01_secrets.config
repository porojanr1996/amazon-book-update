files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/credentials.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Download credentials from Secrets Manager at startup
      aws secretsmanager get-secret-value \
        --secret-id books-reporting/google-sheets-credentials \
        --region eu-north-1 \
        --query SecretString \
        --output text > /var/app/current/credentials.json
      chmod 400 /var/app/current/credentials.json
      chown webapp:webapp /var/app/current/credentials.json

container_commands:
  01_download_credentials:
    command: |
      echo "Downloading credentials from Secrets Manager..."
      aws secretsmanager get-secret-value \
        --secret-id books-reporting/google-sheets-credentials \
        --region eu-north-1 \
        --query SecretString \
        --output text > /var/app/current/credentials.json
      chmod 400 /var/app/current/credentials.json
      chown webapp:webapp /var/app/current/credentials.json
      echo "Credentials downloaded successfully"

