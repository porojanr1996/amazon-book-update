container_commands:
  01_check_credentials:
    command: |
      echo "Checking if credentials.json exists..."
      if [ -f /var/app/current/credentials.json ]; then
        echo "✅ credentials.json exists"
        ls -la /var/app/current/credentials.json
      else
        echo "⚠️ credentials.json does not exist, downloading from Secrets Manager..."
        aws secretsmanager get-secret-value \
          --secret-id books-reporting/google-sheets-credentials \
          --region eu-north-1 \
          --query SecretString \
          --output text > /var/app/current/credentials.json || echo "Failed to download credentials"
        chmod 400 /var/app/current/credentials.json || true
        chown webapp:webapp /var/app/current/credentials.json || true
      fi
    ignoreErrors: true

  02_test_imports:
    command: |
      source /var/app/venv/*/bin/activate
      echo "Testing Python imports..."
      python -c "import app.main; print('✅ app.main imports successfully')" || echo "❌ app.main import failed"
    ignoreErrors: true

